# 炼丹系统快速参考表

## 核心数据速查

### 丹方品阶一览表

| 品阶 | 名称 | 基础成功率 | 需求残页 | 难度系数 | 代表丹药 |
|------|------|-----------|---------|---------|--------|
| grade1 | 一品 | 90% | 10 | 1.0 | 聚灵丹 |
| grade2 | 二品 | 80% | 15 | 1.2 | 聚气丹 |
| grade3 | 三品 | 70% | 20 | 1.5 | 雷灵丹 |
| grade4 | 四品 | 60% | 25 | 2.0 | 仙灵丹 |
| grade5 | 五品 | 50% | 30 | 2.5 | 五行丹 |
| grade6 | 六品 | 40% | 35 | 3.0 | 天元丹 |
| grade7 | 七品 | 30% | 40 | 4.0 | 日月丹 |
| grade8 | 八品 | 20% | 45 | 5.0 | 涅槃丹 |
| grade9 | 九品 | 10% | 50 | 6.0 | - |

### 丹药类型效果倍数

| 类型 | 效果倍数 | 用途 | 示例 |
|------|---------|------|------|
| spirit | ×1.0 | 灵力相关 | 聚灵丹 |
| cultivation | ×1.2 | 修炼相关 | 聚气丹 |
| attribute | ×1.5 | 属性相关 | 雷灵丹 |
| special | ×2.0 | 综合提升 | 仙灵丹 |

---

## 丹方配置速查

### 按类型分类

#### 灵力类 (Spirit) - 效果倍数×1.0
| 丹方ID | 丹药名 | 品阶 | 需求灵草 | 基础效果 | 持续时间 |
|--------|--------|------|---------|---------|---------|
| spirit_gathering | 聚灵丹 | 一品 | 灵精草×2<br/>云雾花×1 | 灵力恢复+20% | 1小时 |
| spirit_recovery | 回灵丹 | 二品 | 玄阴草×2<br/>寒霜莲×1 | 灵力快速恢复+40% | 20分钟 |
| sun_moon_pill | 日月丹 | 七品 | 日精花×2<br/>月华兰×2 | 灵力上限+150% | 40分钟 |

#### 修炼类 (Cultivation) - 效果倍数×1.2
| 丹方ID | 丹药名 | 品阶 | 需求灵草 | 基础效果 | 持续时间 |
|--------|--------|------|---------|---------|---------|
| cultivation_boost | 聚气丹 | 二品 | 云雾花×2<br/>雷击根×1 | 修炼速度+30% | 30分钟 |
| essence_condensation | 凝元丹 | 三品 | 九叶灵芝×2<br/>紫金参×1 | 修炼效率+50% | 25分钟 |
| celestial_essence_pill | 天元丹 | 六品 | 天露草×2<br/>月华兰×1 | 修炼速度+100% | 30分钟 |

#### 属性类 (Attribute) - 效果倍数×1.5
| 丹方ID | 丹药名 | 品阶 | 需求灵草 | 基础效果 | 持续时间 |
|--------|--------|------|---------|---------|---------|
| thunder_power | 雷灵丹 | 三品 | 雷击根×2<br/>龙息草×1 | 战斗属性+40% | 15分钟 |
| fire_essence | 火元丹 | 四品 | 火心花×2<br/>龙息草×1 | 火属性修炼+60% | 30分钟 |
| five_elements_pill | 五行丹 | 五品 | 五行草×2<br/>凤羽草×1 | 全属性+80% | 20分钟 |

#### 特殊类 (Special) - 效果倍数×2.0
| 丹方ID | 丹药名 | 品阶 | 需求灵草 | 基础效果 | 持续时间 |
|--------|--------|------|---------|---------|---------|
| immortal_essence | 仙灵丹 | 四品 | 龙息草×2<br/>仙玉草×1 | 全属性+50% | 10分钟 |
| mind_clarity | 清心丹 | 三品 | 寒霜莲×2<br/>火心花×1 | 心境悟性+30% | 40分钟 |
| phoenix_rebirth_pill | 涅槃丹 | 八品 | 凤羽草×3<br/>天露草×1 | 战斗自动恢复+10% | 1小时 |

---

## 灵草信息一览

### 灵草采集概率与价值

| 灵草ID | 灵草名 | 类型 | 基础价值 | 采集概率 |
|--------|--------|------|---------|---------|
| spirit_grass | 灵精草 | spirit | 10 | 40% |
| cloud_flower | 云雾花 | cultivation | 15 | 30% |
| thunder_root | 雷击根 | attribute | 25 | 15% |
| dragon_breath_herb | 龙息草 | special | 40 | 10% |
| immortal_jade_grass | 仙玉草 | special | 60 | 5% |
| dark_yin_grass | 玄阴草 | spirit | 30 | 20% |
| nine_leaf_lingzhi | 九叶灵芝 | special | 50 | 8% |
| purple_ginseng | 紫金参 | special | 45 | 6% |
| frost_lotus | 寒霜莲 | spirit | 55 | 7% |
| fire_heart_flower | 火心花 | attribute | 35 | 15% |
| moonlight_orchid | 月华兰 | spirit | 70 | 4% |
| sun_essence_flower | 日精花 | cultivation | 75 | 3% |
| five_elements_grass | 五行草 | attribute | 80 | 2% |
| phoenix_feather_herb | 凤羽草 | special | 85 | 1.5% |
| celestial_dew_grass | 天露草 | special | 90 | 1% |

### 灵草品质价值倍数

| 品质 | 倍数 | 概率 | 稀有度 |
|------|------|------|-------|
| common | ×1.0 | 50% | 普遍 |
| uncommon | ×1.5 | 30% | 常见 |
| rare | ×2.0 | 15% | 少见 |
| epic | ×3.0 | 4% | 罕见 |
| legendary | ×5.0 | 1% | 极罕见 |

---

## 常用计算公式

### 效果值计算

```
最终效果 = 基础效果 × 类型倍数 × 等级倍数

其中：
  基础效果 = 丹方配置中的value
  类型倍数 = pillTypes[type].effectMultiplier
  等级倍数 = 1 + (玩家等级 - 1) × 0.1
```

**例子计算**：
- 玩家等级20，炼制聚灵丹
- 基础效果：0.2 (20%)
- 类型倍数：1.0 (灵力类)
- 等级倍数：1 + (20-1)×0.1 = 2.9
- **最终效果** = 0.2 × 1.0 × 2.9 = **0.58 (58%)**

### 成功率计算

```
最终成功率 = 品阶成功率 × 幸运值 × 炼丹技能

例子：
- 四品丹基础成功率：60%
- 玩家幸运值：1.1
- 玩家炼丹技能：1.3
- 最终成功率 = 0.6 × 1.1 × 1.3 = 85.8%
```

### 残页获取成本

```
单片残页成本 = 品阶数字 × 100 灵石

一品(10片×100=1000灵石) - 十片残页
二品(15片×200=3000灵石) - 十五片残页
四品(25片×400=10000灵石) - 二十五片残页
```

---

## 常见操作速查

### 1. 查看已掌握丹方
```javascript
// 获取所有已掌握的丹方对象
const unlockedRecipes = pillRecipes.filter(
  recipe => pillsStore.pillRecipes.includes(recipe.id)
)
```

### 2. 计算单个丹方效果
```javascript
// 例如计算聚灵丹在玩家等级15时的效果
const recipe = pillRecipes.find(r => r.id === 'spirit_gathering')
const effect = calculatePillEffect(recipe, 15)
// effect.value = 0.2 × 1.0 × 2.4 = 0.48 (48%)
```

### 3. 检查是否有足够材料炼制
```javascript
// 检查是否能炼制聚气丹
const recipe = pillRecipes.find(r => r.id === 'cultivation_boost')
const canCraft = recipe.materials.every(material => {
  const owned = inventoryStore.herbs.filter(
    h => h.id === material.herb
  ).length
  return owned >= material.count
})
```

### 4. 获得丹方残页（自动判定合成）
```javascript
// 获得一片天元丹的残页
pillsStore.gainPillFragment('celestial_essence_pill')
// 如果已获得35片残页，自动合成并添加到pillRecipes
```

### 5. 购买丹方残页
```javascript
// 购买天元丹的一片残页
const recipe = pillRecipes.find(r => r.id === 'celestial_essence_pill')
const cost = parseInt(recipe.grade.replace('grade', '')) * 100  // 600灵石
if (inventoryStore.spiritStones >= cost) {
  inventoryStore.spiritStones -= cost
  pillsStore.gainPillFragment(recipe.id)
}
```

---

## UI展示对应值

### 丹方卡片显示

```vue
<!-- 品阶标签 -->
{{ pillGrades[recipe.grade].name }}
<!-- 输出：一品、二品、...、九品 -->

<!-- 类型标签 -->
{{ pillTypes[recipe.type].name }}
<!-- 输出：灵力类、修炼类、属性类、特殊类 -->

<!-- 效果预览 -->
效果数值：+{{ (currentEffect.value * 100).toFixed(1) }}%
持续时间：{{ Math.floor(currentEffect.duration / 60) }}分钟
成功率：{{ (currentEffect.successRate * 100).toFixed(1) }}%
```

### 材料显示

```javascript
// 单个材料状态
const material = { herb: 'spirit_grass', count: 2 }
const owned = inventoryStore.herbs.filter(h => h.id === material.herb).length
const status = `${owned}/2`
// UI显示：灵精草 (需要: 2, 拥有: 1/2)
```

---

## 状态管理对应表

### Pinia Store 字段映射

| 字段 | 存储位置 | 数据类型 | 用途 |
|------|---------|---------|------|
| pillRecipes | pillsStore | Array<string> | 已掌握的丹方ID列表 |
| pillFragments | pillsStore | Object<Map> | 各丹方的残页数量 |
| pills | pillsStore | Array | 背包中的丹药 |
| activeEffects | pillsStore | Array | 当前生效的丹药效果 |
| pillsCrafted | pillsStore | number | 成就相关：总炼制次数 |
| pillsConsumed | pillsStore | number | 成就相关：总服用次数 |
| herbs | inventoryStore | Array | 背包中的灵草 |
| items | inventoryStore | Array | 背包中的物品（含丹药） |
| spiritStones | inventoryStore | number | 灵石余额 |

---

## 性能指标

### 操作时间复杂度

| 操作 | 时间复杂度 | 平均耗时 |
|------|-----------|---------|
| 检查材料充足 | O(n×m) | <10ms |
| 获取单个丹方效果 | O(1) | <1ms |
| 计算已解锁列表 | O(n×m) | <5ms |
| 消耗材料 | O(n×m) | <20ms |
| 创建丹药 | O(1) | <1ms |

**说明**：
- n = 背包中灵草总数 (通常100-1000)
- m = 丹方需求材料种类数 (通常3-4)

---

## 扩展可能性

### 可添加的功能

1. **丹药收藏夹**
   - 标记常用丹方
   - 快速炼制按钮

2. **丹药效果应用**
   - 服用丹药
   - 效果计时显示
   - 多效果叠加

3. **丹方学习NPC**
   - NPC对话系统
   - 直接学习丹方
   - 特殊丹方剧情

4. **高级炼制模式**
   - 批量炼制
   - 自动炼制
   - 炼制配方保存

5. **丹药交易**
   - 玩家之间交易
   - 丹药定价
   - 交易历史

---

## 常见问题

### Q: 如何快速获得高品阶丹药?
A: 高品阶丹药成功率低且材料稀缺。建议：
1. 优先炼制低品阶（成功率高）
2. 通过探索获得残页
3. 提升炼丹技能
4. 积累幸运值

### Q: 灵草不够怎么办?
A: 
1. 前往探索系统采集
2. 关注地点掉落表
3. 收集高品质灵草（备用）
4. 参考灵草采集概率

### Q: 炼制失败会怎样?
A: 消耗材料但不获得丹药
- 建议多囤积备用材料
- 提升个人幸运值
- 解锁炼丹技能成就

### Q: 残页如何快速凑齐?
A:
1. 主要来源：探索系统 (20%-60%概率)
2. 次要来源：购买残页 (100灵石起)
3. 建议方式：混合两种获得

