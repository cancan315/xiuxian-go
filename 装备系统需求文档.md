# 装备系统需求文档

## 1. 系统概述

装备系统是游戏中的核心玩法之一，允许玩家获取、强化、洗练和穿戴各种装备来提升角色实力。装备系统已改造为完全使用后端API，前端只负责UI展示，所有状态管理均由后端负责。

## 2. 装备类型和槽位

游戏中有5种装备槽位：
- `faqi`(法宝)
- `guanjin`(冠巾)
- `daopao`(道袍)
- `yunlv`(云履)
- `fabao`(本命法宝)

## 3. 装备品质系统

装备按照品质分为6个等级：
- 仙器(mythic)
- 伪仙器(legendary)
- 极品灵器(epic)
- 灵器(rare)
- 法器(uncommon)
- 凡器(common)

## 4. 装备核心功能

### 4.1 装备强化
- 强化可以提升装备属性，最高100级
- 每级强化有一定成功率，随着等级提高成功率降低
- 消耗强化石进行强化
- 强化操作完全由后端处理，前端只负责发起请求和展示结果

### 4.2 装备洗练
- 可以改变装备的部分属性值或更换属性类型
- 消耗洗练石进行洗练
- 洗练有一定的随机性
- 洗练操作完全由后端处理，前端只负责发起请求和展示结果

### 4.3 装备穿戴/卸下
- 装备可以穿戴和卸下
- 穿戴时会应用装备属性加成到角色
- 卸下时会移除属性加成
- 装备状态完全由后端管理，前端只负责发起请求和展示当前装备状态

### 4.4 装备出售
- 玩家可以单独或批量出售装备
- 出售后可获得强化石奖励
- 出售操作完全由后端处理，前端只负责发起请求

## 5. 装备属性系统

### 5.1 基础属性
- 攻击力(attack)
- 生命值(health)
- 防御力(defense)
- 速度(speed)

### 5.2 战斗属性
- 暴击率(critRate)
- 连击率(comboRate)
- 反击率(counterRate)
- 眩晕率(stunRate)
- 闪避率(dodgeRate)
- 吸血率(vampireRate)

### 5.3 战斗抗性
- 抗暴击(critResist)
- 抗连击(comboResist)
- 抗反击(counterResist)
- 抗眩晕(stunResist)
- 抗闪避(dodgeResist)
- 抗吸血(vampireResist)

### 5.4 特殊属性
- 强化治疗(healBoost)
- 强化爆伤(critDamageBoost)
- 弱化爆伤(critDamageReduce)
- 最终增伤(finalDamageBoost)
- 最终减伤(finalDamageReduce)
- 战斗属性提升(combatBoost)
- 战斗抗性提升(resistanceBoost)

### 5.5 属性加成管理
- 所有装备属性加成都由后端计算和管理
- 前端不再维护属性加成状态，只展示后端提供的最终属性值

## 6. 后端API接口设计

### 6.1 装备管理接口

#### 获取玩家装备列表
- 接口地址：GET `/api/player/equipment/:userId?`
- 请求参数：
  - userId: 玩家ID（可选）
  - type: 装备类型过滤
  - quality: 装备品质过滤
  - equipped: 装备状态过滤(true/false)
- 返回数据：装备列表

#### 获取装备详情
- 接口地址：GET `/api/player/equipment/details/:id`
- 请求参数：装备ID
- 返回数据：装备详细信息

#### 装备强化
- 接口地址：POST `/api/player/equipment/:id/enhance`
- 请求参数：
  - id: 装备ID
  - reinforceStones: 当前拥有的强化石数量
- 返回数据：强化结果及更新后的装备信息

#### 装备洗练
- 接口地址：POST `/api/player/equipment/:id/reforge`
- 请求参数：
  - id: 装备ID
  - refinementStones: 当前拥有的洗练石数量
- 返回数据：洗练结果及新属性信息

#### 确认洗练结果
- 接口地址：POST `/api/player/equipment/:id/reforge-confirm`
- 请求参数：
  - id: 装备ID
  - confirmed: 是否确认新属性(true/false)
  - newStats: 新的属性值（仅在confirmed为true时需要）
- 返回数据：操作结果

#### 装备穿戴
- 接口地址：POST `/api/player/equipment/:id/equip`
- 请求参数：
  - id: 装备ID
  - slot: 装备槽位类型
- 返回数据：操作结果

#### 装备卸下
- 接口地址：POST `/api/player/equipment/:id/unequip`
- 请求参数：装备ID
- 返回数据：操作结果

#### 出售装备
- 接口地址：DELETE `/api/player/equipment/:id`
- 请求参数：装备ID
- 返回数据：出售结果及获得的资源

#### 批量出售装备
- 接口地址：POST `/api/player/equipment/batch-sell`
- 请求参数：
  - quality: 装备品质过滤
  - type: 装备类型过滤
- 返回数据：出售结果及获得的资源总和

## 7. 数据存储和同步

- 装备数据存储在数据库中，确保持久化
- 通过RESTful API与前端进行数据同步
- 实现增量更新机制，减少网络传输负担
- 装备状态完全由后端维护，前端不再存储装备状态副本

## 8. 响应格式规范

所有API响应遵循统一格式：

### 成功响应
```json
{
  "success": true,
  "message": "操作成功描述",
  "data": {...} // 具体数据
}
```

### 失败响应
```json
{
  "success": false,
  "message": "错误描述",
  "error": "错误详情" // 可选
}
```

## 9. 权限控制

所有装备相关API都需要用户认证，确保玩家只能操作自己的装备数据。

## 10. 前端改造

前端装备系统已改造为完全使用后端API：

1. 移除了本地的强化和洗练逻辑
2. 移除了Web Worker处理逻辑
3. 所有装备操作均通过API服务与后端通信
4. 移除了前端的状态管理，改为完全由后端管理装备状态
5. 前端仅负责UI展示和用户交互