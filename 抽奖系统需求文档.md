# 抽奖系统需求文档

## 1. 系统概述

抽奖系统是游戏的核心玩法之一，允许玩家消耗灵石抽取装备和灵宠。系统支持两种抽奖池：装备池和灵宠池，玩家可以根据需求选择不同的池子进行抽奖。

抽奖系统已改造为完全使用后端API，前端只负责UI展示，所有状态管理和业务逻辑均由后端负责。

## 2. 抽奖池类型

### 2.1 装备池
- 提供各类装备道具
- 装备类型包括：法宝、冠巾、道袍、云履、本命法宝

### 2.2 灵宠池
- 提供各种灵宠

## 3. 抽奖消耗

### 3.1 消耗资源
- 使用灵石进行抽奖
- 不同抽奖次数消耗不同数量的灵石

### 3.2 消耗规则
| 抽奖次数 | 普通消耗 | 心愿单消耗 |
|---------|----------|------------|
| 1次     | 100灵石  | 200灵石    |
| 10次    | 1000灵石 | 2000灵石   |
| 50次    | 5000灵石 | 10000灵石  |
| 100次   | 10000灵石| 20000灵石  |

## 4. 物品品质体系

### 4.1 装备品质
- 凡器(common)：灰色，基础属性
- 法器(uncommon)：绿色，较好属性
- 灵器(rare)：蓝色，良好属性
- 异宝(epic)：紫色，优秀属性
- 法宝(legendary)：橙色，极佳属性
- 仙器(mythic)：粉色，顶级属性

### 4.2 灵宠品质
- 凡兽(common)：灰色，基础属性
- 妖兽(uncommon)：绿色，较好属性
- 灵兽(rare)：蓝色，良好属性
- 上古异兽(epic)：紫色，优秀属性
- 瑞兽(legendary)：橙色，极佳属性
- 仙兽(mythic)：粉色，顶级属性

## 5. 抽奖概率

### 5.1 装备池概率
- 仙器：0.1%
- 法宝：0.3%
- 异宝：1.6%
- 灵器：3%
- 法器：15%
- 凡器：80%

### 5.2 灵宠池概率
- 仙兽：0.1%
- 瑞兽：0.3%
- 上古异兽：1.6%
- 灵兽：3%
- 妖兽：15%
- 凡兽：80%

## 6. 心愿单系统

### 6.1 功能说明
- 玩家可以设定心愿装备品质或灵宠品质
- 启用心愿单后，对应品质的抽取概率会有所提升
- 心愿单会增加抽奖消耗

### 6.2 使用规则
- 可以为装备池和灵宠池分别设置心愿单
- 心愿单只对指定品质生效
- 启用心愿单会使抽奖成本翻倍

## 7. 自动处理系统

### 7.1 自动出售
- 玩家可以设定自动出售指定品质的装备
- 获得的收益为强化石

### 7.2 自动放生
- 玩家可以设定自动放生指定品质的灵宠
- 获得的收益为强化石

## 8. 抽奖结果展示

### 8.1 展示方式
- 抽奖结果以卡片形式展示
- 支持分页浏览
- 提供物品详细信息查看功能

### 8.2 物品详情
- 装备：显示名称、品质、属性等信息
- 灵宠：显示名称、品质、属性、描述等信息

## 9. 数据持久化

### 9.1 存储内容
- 玩家拥有的装备和灵宠
- 心愿单设置
- 自动处理设置
- 抽奖历史记录

### 9.2 存储方式
- 使用Pinia状态管理
- 通过API与后端数据库同步

## 10. 前端实现

### 10.1 主要组件
- GachaMain.vue：主界面组件
- GachaCard.vue：抽奖卡片组件
- GachaButtons.vue：操作按钮组件
- GachaResultModal.vue：抽奖结果弹窗
- ProbabilityInfoModal.vue：概率信息弹窗
- WishlistSettingsModal.vue：心愿单设置弹窗
- AutoSettingsModal.vue：自动处理设置弹窗
- PetDetailModal.vue：灵宠详情弹窗
- EquipmentDetailModal.vue：装备详情弹窗

### 10.2 核心功能模块
- useGacha.js：抽奖逻辑处理（已废弃，仅保留UI交互逻辑）
- useProbability.js：概率计算逻辑（已废弃，仅保留UI展示逻辑）
- useAutoActions.js：自动处理逻辑（已废弃，仅保留UI交互逻辑）
- itemQualities.js：物品品质配置

## 11. 后端API接口

### 11.1 数据同步接口
- GET `/api/player/data`：获取玩家完整数据
- PATCH `/api/player/data`：增量更新玩家数据

### 11.2 抽奖相关接口
- POST `/api/gacha/draw`：执行抽奖操作
  - 参数：{ poolType: 'equipment'|'pet', count: number, useWishlist: boolean }
  - 返回：{ success: boolean, items: Array, message?: string }
- POST `/api/gacha/auto-actions`：执行自动处理操作
  - 参数：{ items: Array, autoSellQualities: Array, autoReleaseRarities: Array }
  - 返回：{ success: boolean, soldItems: Array, releasedPets: Array, stonesGained: number, message?: string }

## 12. 注意事项

1. 所有抽奖结果都需要通过后端验证，防止作弊
2. 抽奖概率需要精确控制，确保公平性
3. 心愿单系统需要平衡概率提升与成本增加的关系
4. 自动处理系统需要及时反馈给玩家处理结果
5. 数据同步需要保证一致性，防止数据丢失
6. 前端不再处理复杂的业务逻辑，只负责UI展示和用户交互
7. 所有物品生成和概率计算由后端完成，前端只接收结果进行展示