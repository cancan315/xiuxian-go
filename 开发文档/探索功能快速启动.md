# æ¢ç´¢åŠŸèƒ½å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹ (5åˆ†é’Ÿ)

### å‰ææ¡ä»¶
- Node.js 18+ (å‰ç«¯)
- Go 1.19+ (åç«¯)
- PostgreSQL 12+ (æ•°æ®åº“)
- Redis (ç¼“å­˜)

### æ­¥éª¤1: å¯åŠ¨åç«¯æœåŠ¡

```bash
# è¿›å…¥åç«¯ç›®å½•
cd server-go

# ç¡®ä¿ç¯å¢ƒå˜é‡æ­£ç¡® (.envæ–‡ä»¶)
# æ•°æ®åº“å·²åˆå§‹åŒ–ï¼Œè¡¨å·²åˆ›å»º

# å¯åŠ¨æœåŠ¡å™¨
go run ./cmd/server

# é¢„æœŸè¾“å‡º
# Go server is running on :3000
```

### æ­¥éª¤2: å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨

```bash
# æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£
cd /é¡¹ç›®æ ¹ç›®å½•

# å®‰è£…ä¾èµ– (å¦‚æœæœªå®‰è£…)
npm install

# å¯åŠ¨å‰ç«¯
npm run dev

# é¢„æœŸè¾“å‡º
# VITE v7.2.6  ready in xxx ms
# Local: http://localhost:2025
```

### æ­¥éª¤3: æµ‹è¯•æ¢ç´¢åŠŸèƒ½

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:2025`
2. ç™»å½•æˆ–æ³¨å†Œè´¦æˆ·
3. å¯¼èˆªåˆ°"æ¢ç´¢"é¡µé¢
4. ç‚¹å‡»"å¼€å§‹æ¢ç´¢"æŒ‰é’®
5. ç­‰å¾…åç«¯è¿”å›äº‹ä»¶
6. é€‰æ‹©äº‹ä»¶é€‰é¡¹
7. æŸ¥çœ‹æ—¥å¿—é¢æ¿ä¸­çš„æ“ä½œè®°å½•

## ğŸ“¡ APIè°ƒè¯•

### ä½¿ç”¨ curl æµ‹è¯•

#### 1. è·å–è®¤è¯token
```bash
TOKEN=$(curl -s -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456"}' \
  | jq -r '.data.token')

echo $TOKEN
```

#### 2. å¼€å§‹æ¢ç´¢
```bash
curl -X POST http://localhost:3000/api/exploration/start \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"duration": 5000}' \
  | jq .
```

#### 3. å¤„ç†äº‹ä»¶é€‰æ‹©
```bash
curl -X POST http://localhost:3000/api/exploration/event-choice \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "eventType": "spirit_stone_found",
    "choice": "accept"
  }' \
  | jq .
```

### ä½¿ç”¨ Postman

1. åˆ›å»ºæ–°é›†åˆ "Exploration API"
2. è®¾ç½® BASE_URL ç¯å¢ƒå˜é‡: `http://localhost:3000`
3. å¯¼å…¥ä»¥ä¸‹è¯·æ±‚:

**è¯·æ±‚1: ç™»å½•**
- æ–¹æ³•: POST
- URL: `{{BASE_URL}}/api/auth/login`
- Body:
```json
{
  "username": "test",
  "password": "123456"
}
```

**è¯·æ±‚2: å¼€å§‹æ¢ç´¢**
- æ–¹æ³•: POST
- URL: `{{BASE_URL}}/api/exploration/start`
- Header: `Authorization: Bearer {{token}}`
- Body:
```json
{
  "duration": 10000
}
```

**è¯·æ±‚3: äº‹ä»¶é€‰æ‹©**
- æ–¹æ³•: POST
- URL: `{{BASE_URL}}/api/exploration/event-choice`
- Header: `Authorization: Bearer {{token}}`
- Body:
```json
{
  "eventType": "spirit_stone_found",
  "choice": "continue"
}
```

## ğŸ” æ—¥å¿—æŸ¥çœ‹

### åç«¯æ—¥å¿—
åç«¯ä½¿ç”¨ zap æ—¥å¿—åº“ï¼Œä¸»è¦è¾“å‡º:
- StartExploration è¯·æ±‚å’Œå“åº”
- HandleEventChoice è¯·æ±‚å’Œå“åº”
- æ•°æ®åº“æ“ä½œé”™è¯¯

### å‰ç«¯æ—¥å¿—
åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12) æŸ¥çœ‹:
1. Console æ ‡ç­¾: æŸ¥çœ‹ JS é”™è¯¯å’Œ console.log
2. Network æ ‡ç­¾: æŸ¥çœ‹ API è¯·æ±‚å’Œå“åº”
3. Application æ ‡ç­¾: æŸ¥çœ‹ localStorage å­˜å‚¨çš„æ•°æ®

### æ•°æ®åº“æ—¥å¿—
```bash
# è¿æ¥PostgreSQLæŸ¥è¯¢å†å²
psql -U postgres -d xiuxian_db

# æŸ¥è¯¢æœ€è¿‘çš„ç”¨æˆ·æ•°æ®å˜åŒ–
SELECT * FROM users WHERE id = 1 ORDER BY updated_at DESC LIMIT 5;

# æŸ¥è¯¢çµçŸ³å˜åŒ–
SELECT spirit_stones FROM users WHERE id = 1;
```

## ğŸ› å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: CORSé”™è¯¯
**é”™è¯¯ä¿¡æ¯**: `Access to XMLHttpRequest blocked by CORS`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ vite.config.js ä¸­çš„ä»£ç†é…ç½®
- ç¡®ä¿åç«¯CORSä¸­é—´ä»¶å·²é…ç½®
- æ£€æŸ¥ API_URL æ˜¯å¦æ­£ç¡®

### é—®é¢˜2: 401 Unauthorized
**é”™è¯¯ä¿¡æ¯**: `ç”¨æˆ·æœªæˆæƒ`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ token æ˜¯å¦æœ‰æ•ˆ (æœªè¿‡æœŸ)
- æ£€æŸ¥ Authorization header æ ¼å¼: `Bearer TOKEN`
- é‡æ–°ç™»å½•è·å–æ–° token

### é—®é¢˜3: æ•°æ®æœªæ›´æ–°
**ç—‡çŠ¶**: è·å¾—çµçŸ³åæ•°æ®åº“æœªæ›´æ–°

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥åç«¯å“åº”ä¸­ success å­—æ®µæ˜¯å¦ä¸º true
2. æŸ¥çœ‹åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
4. ç¡®è®¤äº‹åŠ¡æ˜¯å¦æäº¤

### é—®é¢˜4: äº‹ä»¶æœªè§¦å‘
**ç—‡çŠ¶**: æ¢ç´¢å¤šæ¬¡ä½†æ²¡æœ‰ç‰¹æ®Šäº‹ä»¶

**åŸå› åˆ†æ**:
- æ­£å¸¸ç°è±¡! äº‹ä»¶è§¦å‘æ¦‚ç‡ = 30% Ã— å¹¸è¿å€¼
- å¦‚æœå¹¸è¿å€¼ä¸º1.0ï¼Œå¹³å‡3æ¬¡æ¢ç´¢æ‰æœ‰1æ¬¡äº‹ä»¶
- æ£€æŸ¥ç©å®¶çš„ base_attributes.luck å­—æ®µ

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### å¯ç”¨è¯¦ç»†æ—¥å¿—
ç¼–è¾‘ `server-go/cmd/server/main.go`:
```go
// æ”¹ä¸º DEBUG çº§åˆ«
logLevel := os.Getenv("LOG_LEVEL")  // è®¾ä¸º "debug"
config.Level = zap.NewAtomicLevelAt(zap.DebugLevel)
```

ç„¶åé‡å¯æœåŠ¡å™¨:
```bash
LOG_LEVEL=debug go run ./cmd/server
```

### æ€§èƒ½åˆ†æ
```bash
# ä½¿ç”¨ pprof åˆ†æ
go run -cpuprofile=cpu.prof ./cmd/server

# æŸ¥çœ‹ CPU æ€§èƒ½åˆ†æ
go tool pprof cpu.prof
(pprof) top
(pprof) list StartExploration
```

## âœ… éªŒè¯æ¸…å•

å¯åŠ¨åä¾æ¬¡æ£€æŸ¥:

- [ ] åç«¯æœåŠ¡è¿è¡Œåœ¨ :3000
- [ ] å‰ç«¯å¼€å‘æœåŠ¡è¿è¡Œåœ¨ :2025
- [ ] ç™»å½•é¡µé¢å¯æ­£å¸¸è®¿é—®
- [ ] è®¤è¯ token å¯æ­£å¸¸è·å–
- [ ] æ¢ç´¢ API è¿”å› 200 OK
- [ ] äº‹ä»¶æ•°æ®ç»“æ„æ­£ç¡®
- [ ] æ•°æ®åº“æœ‰æ›´æ–°è®°å½•
- [ ] å‰ç«¯æ—¥å¿—é¢æ¿æ˜¾ç¤ºæ“ä½œè®°å½•
- [ ] æ— æ§åˆ¶å°é”™è¯¯
- [ ] å“åº”æ—¶é—´ < 200ms

## ğŸ“ å­¦ä¹ èµ„æº

### åç«¯ä»£ç ç»“æ„
```
server-go/
â”œâ”€â”€ cmd/server/main.go              # å¯åŠ¨ç‚¹
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ exploration/
â”‚   â”‚   â”œâ”€â”€ models.go               # æ•°æ®ç»“æ„
â”‚   â”‚   â”œâ”€â”€ config.go               # æ¸¸æˆé…ç½®
â”‚   â”‚   â””â”€â”€ service.go              # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â””â”€â”€ exploration/
â”‚   â”‚   â”‚       â””â”€â”€ exploration.go  # HTTPå¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â”‚   â””â”€â”€ router.go           # è·¯ç”±å®šä¹‰
â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”‚       â””â”€â”€ auth.go             # è®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ db.go                   # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ *.go                    # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ redis/
â”‚       â””â”€â”€ redis.go                # Redisè¿æ¥
â””â”€â”€ go.mod, go.sum                  # ä¾èµ–ç®¡ç†
```

### å‰ç«¯ä»£ç ç»“æ„
```
src/
â”œâ”€â”€ views/
â”‚   â””â”€â”€ Exploration.vue             # æ¢ç´¢é¡µé¢
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ *.js                        # PiniaçŠ¶æ€ç®¡ç†
â”œâ”€â”€ services/
â”‚   â””â”€â”€ api.js                      # APIå®¢æˆ·ç«¯
â””â”€â”€ components/
    â”œâ”€â”€ gacha/
    â””â”€â”€ LogPanel.vue                # æ—¥å¿—å±•ç¤º
```

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### ä¿®æ”¹åç«¯
1. ç¼–è¾‘ä»£ç 
2. Ctrl+S ä¿å­˜
3. æŸ¥çœ‹ç»ˆç«¯æ˜¯å¦è‡ªåŠ¨é‡å¯ (air) æˆ–æ‰‹åŠ¨é‡å¯ (go run)
4. é‡æ–°æµ‹è¯• API

### ä¿®æ”¹å‰ç«¯
1. ç¼–è¾‘ Vue æ–‡ä»¶
2. Ctrl+S ä¿å­˜
3. æµè§ˆå™¨è‡ªåŠ¨çƒ­æ›´æ–°
4. æ— éœ€åˆ·æ–°å³å¯çœ‹åˆ°æ•ˆæœ

### ä¿®æ”¹æ•°æ®åº“
1. ç¼–è¾‘ init.sql
2. é‡æ–°åˆå§‹åŒ–æ•°æ®åº“æˆ–æ‰§è¡Œè¿ç§»
3. é‡å¯åç«¯æœåŠ¡

## ğŸš¨ ç´§æ€¥æƒ…å†µ

### åç«¯å´©æºƒ
```bash
# 1. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
# 2. æ£€æŸ¥æ•°æ®åº“è¿æ¥
# 3. æ£€æŸ¥æ—¥å¿—
# 4. é‡å¯æœåŠ¡
kill %1  # ç»ˆæ­¢è¿›ç¨‹
go run ./cmd/server  # é‡å¯
```

### å‰ç«¯ç™½å±
```bash
# 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
# 2. æŸ¥çœ‹ Console å’Œ Network æ ‡ç­¾
# 3. æŸ¥çœ‹æ˜¯å¦æœ‰APIé”™è¯¯
# 4. æ¸…é™¤ç¼“å­˜å’Œcookies
# 5. åˆ·æ–°é¡µé¢ (Ctrl+Shift+R)
```

### æ•°æ®åº“é”å®š
```bash
# è¿æ¥PostgreSQL
psql -U postgres -d xiuxian_db

# æ€æ­»æ‰€æœ‰è¿æ¥
SELECT pg_terminate_backend(pg_stat_activity.pid)
FROM pg_stat_activity
WHERE pg_stat_activity.datname = 'xiuxian_db' AND pid <> pg_backend_pid();

# é‡å¯æœåŠ¡
```

## ğŸ“ è·å–å¸®åŠ©

1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
2. æŸ¥çœ‹ç›¸å…³æ–‡æ¡£
3. æ£€æŸ¥APIè¿”å›å€¼
4. ä½¿ç”¨ curl æˆ– Postman ç‹¬ç«‹æµ‹è¯•API
5. æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·

---

**ç¥ä½ æ¢ç´¢æ„‰å¿«!** ğŸ®âœ¨

