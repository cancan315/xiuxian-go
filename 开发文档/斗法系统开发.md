ğŸ“‹ å¼€å‘æ­¥éª¤æ¦‚è¿°

    åˆ›å»ºæ–—æ³•é¡µé¢ç»„ä»¶

    ä¿®æ”¹ä¸»åº”ç”¨ç»„ä»¶(App.vue)

    æ·»åŠ æˆ˜æ–—ç³»ç»Ÿå·¥å…·ç±»

    åˆ›å»ºç›¸å…³æ¥å£æœåŠ¡

    æµ‹è¯•æ–—æ³•åŠŸèƒ½

ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ–—æ³•é¡µé¢ç»„ä»¶
1.1 åˆ›å»ºæ–‡ä»¶

åœ¨ views/ ç›®å½•ä¸‹åˆ›å»º Duel.vue æ–‡ä»¶
ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ä¸»åº”ç”¨ç»„ä»¶(App.vue)
2.1 åœ¨ App.vue ä¸­æ·»åŠ æ–—æ³•é¡µé¢

æ‰¾åˆ° App.vue ä¸­çš„å¯¼å…¥éƒ¨åˆ†ï¼Œæ·»åŠ ï¼š
javascript

// åœ¨å¯¼å…¥éƒ¨åˆ†æ·»åŠ 
import {
  BookOutline,
  FlaskOutline,
  CompassOutline,
  TrophyOutline,
  SettingsOutline,
  GiftOutline,
  HomeOutline,
  HappyOutline,
  SwordOutline  // æ–°å¢æ–—æ³•å›¾æ ‡
} from '@vicons/ionicons5'

// åœ¨å¯¼å…¥ç»„ä»¶éƒ¨åˆ†æ·»åŠ 
import Duel from './views/Duel.vue'  // æ–°å¢æ–—æ³•é¡µé¢ç»„ä»¶

2.2 åœ¨ currentViewComponent ä¸­æ·»åŠ æ–—æ³•é¡µé¢
javascript

// åœ¨ currentViewComponent è®¡ç®—å±æ€§ä¸­æ·»åŠ 
const currentViewComponent = computed(() => {
  switch (currentView.value) {
    case 'cultivation':
      return Cultivation
    case 'inventory':
      return Inventory
    case 'exploration':
      return Exploration
    case 'settings':
      return Settings
    case 'alchemy':
      return Alchemy
    case 'dungeon':
      return Dungeon
    case 'gacha':
      return Gacha
    case 'leaderboard':
      return Leaderboard
    case 'duel':  // æ–°å¢æ–—æ³•é¡µé¢
      return Duel
    default:
      return Cultivation
  }
})

2.3 åœ¨ menuItems ä¸­æ·»åŠ æ–—æ³•èœå•é¡¹
javascript

// åœ¨ menuItems æ•°ç»„ä¸­æ·»åŠ 
const menuItems = [
  { label: 'ä¿®ç‚¼', key: 'cultivation', icon: BookOutline },
  { label: 'èƒŒåŒ…', key: 'inventory', icon: FlaskOutline },
  { label: 'æŠ½å¥–', key: 'gacha', icon: GiftOutline },
  { label: 'ç‚¼ä¸¹', key: 'alchemy', icon: FlaskOutline },
  { label: 'æ¢ç´¢', key: 'exploration', icon: CompassOutline },
  { label: 'ç§˜å¢ƒ', key: 'dungeon', icon: Flash },
  { label: 'æ–—æ³•', key: 'duel', icon: SwordOutline },  // æ–°å¢æ–—æ³•èœå•é¡¹
  { label: 'æ’è¡Œæ¦œ', key: 'leaderboard', icon: TrophyOutline },
  { label: 'è®¾ç½®', key: 'settings', icon: SettingsOutline }
]

2.4 åœ¨èœå•æç¤ºæ˜ å°„ä¸­æ·»åŠ æ–—æ³•
javascript

// åœ¨ menuKeyToMessage å¯¹è±¡ä¸­æ·»åŠ 
const menuKeyToMessage = {
  cultivation: 'æ‰“å¼€ä¿®ç‚¼',
  inventory: 'æ‰“å¼€èƒŒåŒ…',
  gacha: 'æ‰“å¼€æŠ½å¥–',
  alchemy: 'æ‰“å¼€ç‚¼ä¸¹',
  exploration: 'æ‰“å¼€æ¢ç´¢',
  dungeon: 'è¿›å…¥ç§˜å¢ƒ',
  duel: 'è¿›å…¥æ–—æ³•',  // æ–°å¢æ–—æ³•æç¤ºæ–‡æœ¬
  leaderboard: 'æŸ¥çœ‹æ’è¡Œæ¦œ',
  settings: 'æ‰“å¼€è®¾ç½®'
}

ç¬¬å…­æ­¥ï¼šæ›´æ–°åç«¯APIï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœä½ æœ‰åç«¯APIï¼Œéœ€è¦åœ¨åç«¯æ·»åŠ ä»¥ä¸‹æ¥å£ï¼š
7.1 æµ‹è¯•æ­¥éª¤

    å¯åŠ¨åº”ç”¨ï¼šè¿è¡Œä½ çš„Vueåº”ç”¨

    ç™»å½•è´¦å·ï¼šä½¿ç”¨å·²æœ‰è´¦å·ç™»å½•

    è®¿é—®æ–—æ³•é¡µé¢ï¼šç‚¹å‡»"æ–—æ³•"èœå•é¡¹

    æµ‹è¯•åŠŸèƒ½ï¼š

        æŸ¥çœ‹å¯¹æ‰‹åˆ—è¡¨

        æŸ¥çœ‹å¦–å…½åˆ—è¡¨

        æŒ‘æˆ˜å…¶ä»–ç©å®¶

        æŒ‘æˆ˜å¦–å…½

        æŸ¥çœ‹æˆ˜æ–—è®°å½•

        æŸ¥çœ‹æˆ˜ç»©ç»Ÿè®¡

7.2 å¸¸è§é—®é¢˜æ’æŸ¥

    å›¾æ ‡ä¸æ˜¾ç¤ºï¼šç¡®ä¿æ­£ç¡®å¯¼å…¥äº† SwordOutline å›¾æ ‡

    é¡µé¢ä¸åˆ‡æ¢ï¼šæ£€æŸ¥ currentViewComponent è®¡ç®—å±æ€§æ˜¯å¦æ­£ç¡®æ·»åŠ äº†æ–—æ³•é¡µé¢

    æˆ˜æ–—æ¨¡æ‹Ÿå¤±è´¥ï¼šæ£€æŸ¥ battleSimulator.js æ˜¯å¦æ­£ç¡®å¯¼å…¥

    APIè¯·æ±‚å¤±è´¥ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥å’Œåç«¯APIæ˜¯å¦æ­£å¸¸

    å„æ¨¡å—åŠŸèƒ½è¯´æ˜
æ–‡ä»¶	åŠŸèƒ½	ä¸»è¦ä»£ç 
DuelPVP.vue	ç©å®¶å¯¹æˆ˜åŠŸèƒ½	å¯¹æ‰‹åˆ—è¡¨ã€åˆ·æ–°å¯¹æ‰‹ã€å¯¹æˆ˜è®°å½•è¡¨
DuelPVE.vue	å¦–å…½æŒ‘æˆ˜åŠŸèƒ½	éš¾åº¦é€‰æ‹©ã€å¦–å…½åˆ—è¡¨ã€å±æ€§å±•ç¤º
DuelRecords.vue	æˆ˜ç»©ç»Ÿè®¡	èƒœç‡ç»Ÿè®¡ã€æˆ˜æ–—è®°å½•è¡¨ã€è¯¦ç»†æ•°æ®
BattleModal.vue	æˆ˜æ–—å±•ç¤º	æˆ˜æ–—æ—¥å¿—ã€æˆ˜æ–—ç»“æœã€å¥–åŠ±é¢†å–
PlayerInfoModal.vue	ç©å®¶è¯¦æƒ…	é“å·ã€å¢ƒç•Œã€ä¿®ä¸ºã€çµçŸ³ç­‰ä¿¡æ¯
useDuel.js	æ ¸å¿ƒä¸šåŠ¡é€»è¾‘	æŒ‘æˆ˜ç©å®¶ã€æŒ‘æˆ˜å¦–å…½ã€é¢†å–å¥–åŠ±ç­‰
duelHelper.js	å·¥å…·å‡½æ•°	æ ‡ç­¾ç±»å‹ã€éš¾åº¦è½¬æ¢ã€æ—¥å¿—ç±»å‹ç­‰
Duel.vue	é¡µé¢å®¹å™¨	ç»„ä»¶åè°ƒã€äº‹ä»¶è·¯ç”±ã€æ•°æ®ä¼ é€’
ğŸ¯ æ¨¡å—åŒ–ä¼˜åŠ¿
âœ¨ ä»£ç åˆ†ç¦» - æ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€ï¼Œæ˜“äºç»´æŠ¤
âœ¨ é€»è¾‘å¤ç”¨ - useDuel.js ç»Ÿä¸€ç®¡ç†ä¸šåŠ¡é€»è¾‘
âœ¨ ä¾¿äºæ‰©å±• - å¯è½»æ¾æ·»åŠ æ–°åŠŸèƒ½æˆ–ä¿®æ”¹ç°æœ‰åŠŸèƒ½
âœ¨ æµ‹è¯•å‹å¥½ - æ¯ä¸ªæ¨¡å—éƒ½å¯ç‹¬ç«‹å•å…ƒæµ‹è¯•
âœ¨ ä»£ç æ•´æ´ - å‡å°‘é‡å¤ä»£ç ï¼Œæé«˜ä»£ç è´¨é‡


Go åç«¯ API å·²æˆåŠŸæ·»åŠ ï¼
æˆ‘å·²ç»ä¸ºæ‚¨çš„æ–—æ³•ç³»ç»Ÿå®Œæ•´é›†æˆäº† Go åç«¯ APIã€‚ä»¥ä¸‹æ˜¯æ‰€æœ‰å®ç°çš„å†…å®¹ï¼š
ğŸ“¦ å‰ç«¯ API æœåŠ¡æ›´æ–° (src/services/api.js)
å·²å°†æ¨¡æ‹Ÿæ•°æ®æ›¿æ¢ä¸ºçœŸå®çš„ Go åç«¯ API è°ƒç”¨ï¼š
æ–¹æ³•å	åŠŸèƒ½	API ç«¯ç‚¹	è¯´æ˜
getDuelOpponents(token, page, pageSize)	è·å–å¯¹æ‰‹åˆ—è¡¨	GET /api/duel/opponents	åˆ†é¡µè·å–åœ¨çº¿ç©å®¶ï¼ˆéšæœºé¡ºåºï¼‰
getPlayerBattleData(playerId, token)	è·å–ç©å®¶æˆ˜æ–—æ•°æ®	GET /api/duel/player/:playerId/battle-data	è·å–æŒ‡å®šç©å®¶çš„å®Œæ•´æˆ˜æ–—å±æ€§
getBattleRecords(token, page, pageSize)	è·å–æˆ˜æ–—è®°å½•	GET /api/duel/records	åˆ†é¡µè·å–ç©å®¶çš„æˆ˜æ–—å†å²å’Œç»Ÿè®¡
recordBattleResult(token, battleData)	è®°å½•æˆ˜æ–—ç»“æœ	POST /api/duel/record-result	ä¿å­˜æˆ˜æ–—ç»“æœåˆ°æ•°æ®åº“
claimBattleRewards(token, rewards)	é¢†å–å¥–åŠ±	POST /api/duel/claim-rewards	å¤„ç†å¥–åŠ±é¢†å–
ğŸ”§ Go åç«¯å®ç°
1. HTTP å¤„ç†å™¨ (server-go/internal/http/handlers/duel/duel.go)
5ä¸ªå¤„ç†å‡½æ•°å¯¹åº”5ä¸ªAPIç«¯ç‚¹
å®Œæ•´çš„å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†
ä¸å‰ç«¯çš„æ ‡å‡† JSON å“åº”æ ¼å¼
2. æ•°æ®åº“æŸ¥è¯¢ (server-go/internal/db/duel.go)
GetDuelOpponents() - ä»æ•°æ®åº“è·å–å¯¹æ‰‹åˆ—è¡¨
GetPlayerBattleData() - è·å–ç©å®¶æˆ˜æ–—æ•°æ®
GetDuelRecords() - è·å–æˆ˜æ–—è®°å½•å’Œç»Ÿè®¡
RecordBattleResult() - ä¿å­˜æˆ˜æ–—ç»“æœ
ClaimBattleRewards() - å¤„ç†å¥–åŠ±
3. æ•°æ®æ¨¡å‹ (server-go/internal/models/duel.go)
BattleRecord - æˆ˜æ–—è®°å½•æ¨¡å‹
DuelStats - æˆ˜æ–—ç»Ÿè®¡æ¨¡å‹
Opponent - å¯¹æ‰‹ä¿¡æ¯æ¨¡å‹
4. è·¯ç”±é…ç½® (server-go/internal/http/router/router.go)
go
// /api/duel è·¯ç”±
duelGroup := r.Group("/api/duel")
{
    duelGroup.Use(middleware.Protect())
    duelGroup.GET("/opponents", duel.GetDuelOpponents)
    duelGroup.GET("/player/:playerId/battle-data", duel.GetPlayerBattleData)
    duelGroup.GET("/records", duel.GetDuelRecords)
    duelGroup.POST("/record-result", duel.RecordBattleResult)
    duelGroup.POST("/claim-rewards", duel.ClaimBattleRewards)
}
ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„è¦æ±‚
æ‚¨éœ€è¦åœ¨æ•°æ®åº“ä¸­åˆ›å»º battle_records è¡¨ï¼š
sql
CREATE TABLE battle_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    player_id BIGINT NOT NULL,
    opponent_id BIGINT NOT NULL,
    opponent_name VARCHAR(255) NOT NULL,
    result VARCHAR(10) NOT NULL COMMENT 'èƒœåˆ© or å¤±è´¥',
    battle_type VARCHAR(10) NOT NULL COMMENT 'pvp or pve',
    rewards TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (player_id) REFERENCES users(id),
    INDEX idx_player_id (player_id),
    INDEX idx_created_at (created_at)
);
ğŸš€ ä½¿ç”¨æµç¨‹
è·å–å¯¹æ‰‹åˆ—è¡¨ â†’ è°ƒç”¨ getDuelOpponents()
é€‰æ‹©å¯¹æ‰‹ â†’ è°ƒç”¨ getPlayerBattleData() è·å–å…¶æˆ˜æ–—æ•°æ®
è¿›è¡Œæˆ˜æ–— â†’ å‰ç«¯æœ¬åœ°æ¨¡æ‹Ÿæˆ˜æ–—ï¼ˆä½¿ç”¨ simulateBattle()ï¼‰
è®°å½•ç»“æœ â†’ è°ƒç”¨ recordBattleResult() ä¿å­˜åˆ°æ•°æ®åº“
é¢†å–å¥–åŠ± â†’ è°ƒç”¨ claimBattleRewards() å¤„ç†å¥–åŠ±
âš ï¸ é‡è¦è¯´æ˜
æ‰€æœ‰ API ç«¯ç‚¹éƒ½éœ€è¦ï¼š
âœ… æœ‰æ•ˆçš„ Bearer Tokenï¼ˆé€šè¿‡ Authorization å¤´ä¼ é€’ï¼‰
âœ… æ•°æ®åº“ä¸­ç›¸åº”çš„è¡¨å’Œæ•°æ®
âœ… ä¸­é—´ä»¶ä¿æŠ¤ (middleware.Protect())
